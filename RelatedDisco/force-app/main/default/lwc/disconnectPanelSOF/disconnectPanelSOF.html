<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<template>
    <template if:false={tasksFetchError}>
        <lightning-card title="Disconnection Panel">
            <lightning-spinner
                if:true={isLoading}
                alternative-text="Loading"
                size="large"
            ></lightning-spinner>
            <template if:false={isLoading}>
                <div
                    class="slds-form"
                    role="list"
                >
                    <div class="slds-form__row">
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">
                                    Contract Status: </span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">
                                        {contractStatus}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Disconnect Request Received Date</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">
                                        {discoReqRecievedDate}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-form__row">
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Equipment Pickup Needed for Disconnect</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{equipPickupForDisco}</div>
                                    
                                </div>
                            </div>
                        </div>
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Custom Requested Disconnect Date</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{custReqDiscoDate}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-form__row">
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Service End Reason</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">
                                        {serviceEndReason}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Proceed With Disconnect</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{proceedDisco}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-form__row">
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Sub-Reasons</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{subReasons}</div>
                                </div>
                            </div>
                        </div>
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                <span class="slds-form-element__label">Disconnect Contact</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static">{discoContact}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-form__row">
                        <div
                            class="slds-form__item"
                            role="listitem"
                        >
                            <div
                                class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent slds-form-element_1-col">
                                <span class="slds-form-element__label">End Reasons Notes</span>
                                <div class="slds-form-element__control">
                                    <div class="slds-form-element__static slds-text-longform">{endReasonNotes}
                                        <br />
                                    </div>
                                    <button
                                        class="slds-button slds-button_icon"
                                        title="Edit: End Reasons Notes"
                                    >
                                        <svg
                                            class="slds-button__icon slds-button__icon_hint"
                                            aria-hidden="true"
                                        >
                                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#edit"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Edit: End Reasons Notes</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <br>
            <div class="slds-align_absolute-center"> <h3>Disconnect Task List</h3></div>
                <template if:false={isDiscoInProg}>
                    <lightning-card title="Disconnect Task List">
                        <lightning-input
                            style="width: 300px;"
                            type="date"
                            label="Enter Customer Requested Disconnect Date"
                            value={selectedDate}
                            onchange={handleDateChange}
                        ></lightning-input>
                    </lightning-card>
                    <lightning-button
                        variant="brand"
                        label="Disconnect"
                        onclick={initiateDisconnect}
                    ></lightning-button>
                </template>
                <template if:true={isDiscoInProg}>
                    <template if:true={isLoading}>
                        <lightning-spinner
                            alternative-text="Loading"
                            size="large"
                        ></lightning-spinner>
                    </template>
                    <template if:false={isLoading}>
                        <lightning-tile title="Customer Selected Disconnect Date">
                            <lightning-formatted-date-time
                                value={selectedDate}
                                year="numeric"
                                month="long"
                                day="2-digit"
                            ></lightning-formatted-date-time>
                        </lightning-tile>
                        <template if:true={useNewTable}>
                            <table
                                class="slds-table slds-table_cell-buffer slds-table_bordered"
                                aria-labelledby="element-with-table-label other-element-with-table-label"
                            >
                                <tbody>
                                    <tr>
                                        <th>Milestone Name</th>
                                        <th>Task Name</th>
                                        <th>Complete</th>
                                        <th>Not Needed</th>
                                    </tr>
                                    <template
                                        for:each={taskData}
                                        for:item="task"
                                    >
                                        <tr key={task.Id}>
                                            <td>{task.Milestone_Name__c}</td>
                                            <td>
                                                <a
                                                    href={task.recordLink}
                                                    target="_blank"
                                                >
                                                    {task.Name}
                                                </a>
                                            </td>
                                            <td>
                                                <input
                                                    type="checkbox"
                                                    checked={task.MPM4_BASE__Complete__c}
                                                    data-id={task.Id}
                                                    data-field="MPM4_BASE__Complete__c"
                                                    onchange={handleCheckboxChange}
                                                    value={task.MPM4_BASE__Complete__c}
                                                />
                                            </td>
                                            <td>
                                                <input
                                                    type="checkbox"
                                                    checked={task.Not_Applicable__c}
                                                    data-id={task.Id}
                                                    data-field="Not_Applicable__c"
                                                    onchange={handleCheckboxChange}
                                                    value={task.Not_Applicable__c}
                                                />
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </template>
                    <template if:true={hasTasks}>

                        <lightning-button
                            class="slds-var-m-around_x-small"
                            variant="brand"
                            label="Update Tasks"
                            onclick={updateTasks}
                        ></lightning-button>

                        <lightning-button
                            class="slds-var-m-around_x-small"
                            variant="brand"
                            label="Cancel Update"
                            onclick={handleCancel}
                        ></lightning-button>

                    </template>

                </template>

            </template>
        </lightning-card>
    </template>
    <template if:true={tasksFetchError}>
        <div style="text-align: center; padding: 10px;">
            <p>There was an issue retrieving tasks. Wait 5 min refresh if there is still an error file a ticket</p>
        </div>
    </template>
</template>